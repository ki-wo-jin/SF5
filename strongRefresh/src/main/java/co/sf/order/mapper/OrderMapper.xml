<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="co.sf.order.mapper.OrderMapper">

    <!-- 주문 정보 추가 -->
    <insert id="addAddress" parameterType="co.sf.order.vo.OrderVO">
        INSERT INTO order_f5 (order_code, id, recipient, phone, address, total_price, email)
        VALUES (#{orderCode}, #{id}, #{recipient}, #{phone}, #{address}, #{totalPrice}, #{email})
    </insert>

    <!-- 카트 항목 삭제 -->
    <delete id="removeCartItem" parameterType="co.sf.order.vo.OrderDetailVO">
        DELETE FROM cart_f5
        WHERE cart_code = #{cartCode}
    </delete>

    <!-- 주문 상세 목록 조회 -->
    <select id="orderDetailList" parameterType="string" resultType="co.sf.order.vo.OrderDetailVO">
        SELECT o.order_code AS orderCode,
               o.recipient AS recipient,
               p.price, 
               od.product_cnt as productCnt,
               SUM(od.product_cnt * p.price) AS totalPrice, 
               o.order_status AS orderStatus,
               p.product_name AS productName,
               p.thum_image AS thumImage,
               o.use_point AS point
               
        FROM order_f5 o
        JOIN order_detail_f5 od ON o.order_code = od.order_code
        JOIN product_f5 p ON od.product_code = p.product_code
        WHERE o.id = #{id}
        GROUP BY o.order_code, o.recipient, o.order_status, p.product_name, p.thum_image, o.use_point, od.product_cnt, p.price
    </select>
    
    <!-- 주문 상세 삭제 -->
    <delete id="removeOrderDetail" parameterType="string">
        DELETE FROM order_detail_f5 WHERE order_detail_code = #{orderDetailCode}
    </delete>
</mapper>
